services:
  api:
    build: .
    container_name: well-monitor-api
    command: uvicorn src.api:app --host 0.0.0.0 --port 80 --reload
    ports:
      - 80:80
      - 5678:5678
    volumes:
      - .:/code
    depends_on:
      - redis
  monitor:
    build: .
    container_name: well-monitor-monitor
    group_add:
      - dialout
    command: /start-monitor.sh
    environment:
      - PYTHONUNBUFFERED=1
      - LOGLEVEL=INFO
      - SERIALPORT=/dev/ttyUSB0
      - BAUDRATE=19200
    volumes:
      - .:/code
    devices:
      - /dev/tty.usbserial-14520
    depends_on:
      - redis
  # simulator:
  #   build: .
  #   container_name: well-monitor-simulator
  #   command: /start-simulator.sh
  #   environment:
  #     - PYTHONUNBUFFERED=1
  #     - LOGLEVEL=INFO
  #     - SERIALPORT=/dev/ttyS20
  #     - BAUDRATE=19200
  #   volumes:
  #     - .:/code
  #   depends_on:
  #     - monitor
  redis:
    image: redis:alpine
